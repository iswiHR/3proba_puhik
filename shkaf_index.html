<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Монстрик в шкафу</title>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />

  <!-- three.js через import map -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
    }
  }
  </script>

  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Helvetica Neue", Arial, sans-serif;
      background: #f5f5f7;
      color: #111;
    }

    button {
      border: none;
      background: none;
      padding: 0;
      font: inherit;
      cursor: pointer;
    }

    .app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* Верхняя панель */

    .top-bar {
      width: 100%;
      max-width: 375px;
      padding: 16px 20px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .back-button {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #111;
      font-size: 14px;
    }

    .back-arrow {
      font-size: 16px;
      transform: translateY(-1px);
    }

    .icon-button {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      border: 1.5px solid #111;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.8);
    }

    .hanger-icon {
      width: 16px;
      height: 10px;
      border-bottom: 1.5px solid #111;
      border-radius: 0 0 50% 50%;
      position: relative;
    }

    .hanger-icon::before {
      content: "";
      position: absolute;
      left: 50%;
      top: -4px;
      width: 6px;
      height: 6px;
      border: 1.5px solid #111;
      border-radius: 50%;
      transform: translateX(-50%);
      border-bottom-color: transparent;
      border-left-color: transparent;
    }

    /* Контент с шкафом */

    .content {
      flex: 1;
      width: 100%;
      display: flex;
      justify-content: center;
      padding: 24px 0 80px;
    }

    .wardrobe-wrapper {
      position: relative;
      width: 260px;
      max-width: 80vw;
      margin-top: 24px;
    }

    .wardrobe-image {
      display: block;
      width: 100%;
      height: auto;
      border-radius: 12px;
    }

    /* Кнопки слева от шкафа */

    .side-button {
      position: absolute;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: #ffffff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.18);
      border: none;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      cursor: pointer;
      z-index: 15;
    }

    /* две кнопки в средней части, одна – внизу, как на макете */
    .side-button-1 {
      left: 18%;
      top: 36%;
    }

    .side-button-2 {
      left: 18%;
      top: 50%;
    }

    .side-button-3 {
      left: 18%;
      top: 70%;
    }

    .side-button:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
    }

    .side-button:active {
      transform: scale(0.95);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    /* Контейнер под 3D-монстра — центральная секция шкафа */

    .monster-container {
      position: absolute;
      left: 50%;
      top: 56%;               /* центр пустой секции */
      transform: translate(-50%, -50%);
      width: 38%;             /* ширина средней колонки */
      height: 58%;            /* высота центральной области */
      pointer-events: none;
      z-index: 20;
      overflow: visible;
    }

    .monster-container canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    /* Нижняя панель с монеткой */

    .bottom-panel {
      position: fixed;
      left: 50%;
      bottom: 24px;
      transform: translateX(-50%);
      width: 100%;
      max-width: 375px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 16px;
      pointer-events: none;
    }

    .coin-button {
      pointer-events: auto;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 22px;
      border-radius: 999px;
      background: #f7d9b8;
      font-size: 14px;
      box-shadow: 0 4px 9px rgba(0, 0, 0, 0.15);
    }

    .coin-icon {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1.5px solid #111;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }

    .round-button {
      pointer-events: auto;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #f7d9b8;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      box-shadow: 0 4px 9px rgba(0, 0, 0, 0.15);
    }

    /* Модальное окно “откроется на 5 уровне” */

    .modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 200;
    }

    .modal.visible {
      display: flex;
    }

    .modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.25);
    }

    .modal-window {
      position: relative;
      max-width: 300px;
      width: 80%;
      background: #ffffff;
      border-radius: 18px;
      padding: 20px 20px 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
      text-align: center;
      z-index: 1;
    }

    .modal-text {
      margin: 0 0 16px;
      font-size: 14px;
      line-height: 1.4;
    }

    .modal-close-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 18px;
      border-radius: 999px;
      background: #ff4b4b;
      color: #fff;
      font-size: 14px;
    }

    .modal-close-button:active {
      transform: translateY(1px);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25) inset;
    }

    @media (max-width: 380px) {
      .wardrobe-wrapper {
        width: 230px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="top-bar">
      <button class="back-button" id="backButton">
        <span class="back-arrow">←</span>
        <span>Назад</span>
      </button>

      <button class="icon-button" id="hangerButton" aria-label="Гардероб">
        <span class="hanger-icon"></span>
      </button>
    </header>

    <main class="content">
      <div class="wardrobe-wrapper">
        <!-- ШКАФ – картинка. Файл должен лежать рядом с html и называться строго wardrobe.png -->
        <img
          src="wardrobe.png"
          alt="Шкаф"
          class="wardrobe-image"
        />

        <!-- Круглые кнопки слева от шкафа -->
        <button class="side-button side-button-1" id="sideButton1"></button>
        <button class="side-button side-button-2" id="sideButton2"></button>
        <button class="side-button side-button-3" id="sideButton3"></button>

        <!-- Контейнер, в который three.js будет рендерить монстрика -->
        <div class="monster-container" id="monsterContainer"></div>
      </div>
    </main>

    <!-- Нижняя плашка с монеткой -->
    <div class="bottom-panel">
      <button class="coin-button" id="coinButton">
        <span class="coin-text">30</span>
        <span class="coin-icon">◎</span>
      </button>
      <button class="round-button" id="plusButton">+</button>
    </div>
  </div>

  <!-- Модалка “откроется на 5 уровне! ждём тебя, совсем скоро!” -->
  <div class="modal" id="lockedModal">
    <div class="modal-backdrop"></div>
    <div class="modal-window">
      <p class="modal-text">
        откроется на 5 уровне! ждем тебя, совсем скоро!
      </p>
      <button class="modal-close-button" id="modalCloseButton">понятно</button>
    </div>
  </div>

  <!-- JS: three.js + логика -->
  <script type="module">
    /***********************
     * Импорты three.js
     ***********************/
    import * as THREE from "three";
    import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";
    import { DRACOLoader } from "three/addons/loaders/DRACOLoader.js";

    /***********************
     * DOM-элементы
     ***********************/
    const backButton = document.getElementById("backButton");
    const hangerButton = document.getElementById("hangerButton");
    const sideButton1 = document.getElementById("sideButton1");
    const sideButton2 = document.getElementById("sideButton2");
    const sideButton3 = document.getElementById("sideButton3");
    const coinButton = document.getElementById("coinButton");
    const plusButton = document.getElementById("plusButton");

    const monsterContainer = document.getElementById("monsterContainer");

    const modal = document.getElementById("lockedModal");
    const modalBackdrop = modal.querySelector(".modal-backdrop");
    const modalCloseButton = document.getElementById("modalCloseButton");

    /***********************
     * Обработчики интерфейса
     ***********************/

    // Кнопка "Назад"
    backButton.addEventListener("click", () => {
      window.location.href =
        "https://mmarmar4028-gif.github.io/kids-site/game_screen.html";
    });

    // Плашка по вешалке
    hangerButton.addEventListener("click", () => {
      modal.classList.add("visible");
    });

    // Плашка по одной из боковых кнопок (как просил)
    sideButton2.addEventListener("click", () => {
      console.log("Вторая боковая кнопка нажата");
      modal.classList.add("visible");
    });

    // Остальные боковые кнопки — просто логи
    sideButton1.addEventListener("click", () => {
      console.log("Первая боковая кнопка нажата");
    });

    sideButton3.addEventListener("click", () => {
      console.log("Третья боковая кнопка нажата");
    });

    // Закрытие модалки
    const closeModal = () => modal.classList.remove("visible");
    modalCloseButton.addEventListener("click", closeModal);
    modalBackdrop.addEventListener("click", closeModal);

    // Монетка, плюс — лог
    coinButton.addEventListener("click", () => {
      console.log("Кнопка монет нажата");
    });

    plusButton.addEventListener("click", () => {
      console.log("Кнопка '+' нажата");
    });

    /***********************
     * THREE.JS: сцена, камера, рендер
     ***********************/
    const scene = new THREE.Scene();

    const camera = new THREE.PerspectiveCamera(35, 1, 0.1, 100);
    // Чуть выше и дальше, чтобы монстр полностью влез в секцию
    camera.position.set(0, 0.4, 2.1);

    const renderer = new THREE.WebGLRenderer({
      antialias: true,
      alpha: true
    });
    renderer.setPixelRatio(window.devicePixelRatio || 1);
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    monsterContainer.appendChild(renderer.domElement);

    function resizeRenderer() {
      const width = monsterContainer.clientWidth || 200;
      const height = monsterContainer.clientHeight || 200;
      renderer.setSize(width, height, false);
      camera.aspect = width / height;
      camera.updateProjectionMatrix();
    }

    resizeRenderer();
    window.addEventListener("resize", resizeRenderer);

    // Свет
    const hemiLight = new THREE.HemisphereLight(0xffffff, 0xffcccc, 1.2);
    hemiLight.position.set(0, 1, 0);
    scene.add(hemiLight);

    const dirLight = new THREE.DirectionalLight(0xffffff, 0.9);
    dirLight.position.set(1, 1.2, 1.5);
    scene.add(dirLight);

    /***********************
     * Загрузка DRACO + GLB-модели
     ***********************/
    const dracoLoader = new DRACOLoader();
    dracoLoader.setDecoderPath(
      "https://www.gstatic.com/draco/versioned/decoders/1.5.6/"
    );
    dracoLoader.setDecoderConfig({ type: "js" });
    dracoLoader.preload();

    const gltfLoader = new GLTFLoader();
    gltfLoader.setDRACOLoader(dracoLoader);

    let monster = null;

    gltfLoader.load(
      "monster.glb",
      (gltf) => {
        monster = gltf.scene;

        // Автоматически подгоняем монстра под секцию шкафа
        const box = new THREE.Box3().setFromObject(monster);
        const size = new THREE.Vector3();
        box.getSize(size);
        const center = new THREE.Vector3();
        box.getCenter(center);

        // Центрируем модель в (0,0,0)
        monster.position.sub(center);

        // Хотим высоту примерно 1.4 условных единицы
        const targetHeight = 1.4;
        const scale = targetHeight / size.y;
        monster.scale.setScalar(scale);

        // Опускаем так, чтобы стоял "на полке"
        monster.position.y = -targetHeight / 2 + 0.05;

        monster.traverse((child) => {
          if (child.isMesh) {
            child.castShadow = false;
            child.receiveShadow = false;
          }
        });

        scene.add(monster);
        console.log("Модель монстрика успешно загружена");
      },
      undefined,
      (error) => {
        console.error("Ошибка при загрузке модели монстрика:", error);
        createFallbackMonster();
      }
    );

    // Фоллбек-монстрик, если с .glb что-то не так
    function createFallbackMonster() {
      const geom = new THREE.SphereGeometry(0.5, 32, 32, 0, Math.PI);
      const mat = new THREE.MeshStandardMaterial({
        color: 0xff4b4b
      });
      const fallback = new THREE.Mesh(geom, mat);
      fallback.position.set(0, -0.3, 0);
      scene.add(fallback);
    }

    /***********************
     * Анимация — монстрик крутится по Y
     ***********************/
    function animate() {
      requestAnimationFrame(animate);

      if (monster) {
        monster.rotation.y += 0.01;
      }

      renderer.render(scene, camera);
    }

    animate();
  </script>
</body>
</html>
